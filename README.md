# Voltaflow Log Interpreter

This GitHub Action uses the Deepseek API (through the OpenAI library) to interpret logs and provide clear explanations and possible solutions. The action comments the results directly on the PR.

## Features

- Analyzes logs of any type (application, system, errors, etc.)
- Identifies patterns, errors, and important events
- Explains problems in clear language
- Suggests possible solutions
- Formats the output with Markdown for easy reading

## Usage

### Basic Example

```yaml
name: Interpret Logs

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  analyze-logs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      # Step that generates logs (for example, running tests)
      - name: Run tests
        run: npm test > test_logs.txt 2>&1
        continue-on-error: true
      
      # Read the generated logs
      - name: Read logs
        id: logs
        run: |
          LOG_CONTENT=$(cat test_logs.txt)
          LOG_CONTENT="${LOG_CONTENT//'%'/'%25'}"
          LOG_CONTENT="${LOG_CONTENT//$'\n'/'%0A'}"
          LOG_CONTENT="${LOG_CONTENT//$'\r'/'%0D'}"
          echo "::set-output name=log_content::$LOG_CONTENT"
      
      # Use this action to interpret the logs
      - name: Interpret logs with Voltaflow
        uses: your-username/voltaflow-pr-check@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          deepseek_api_key: ${{ secrets.DEEPSEEK_API_KEY }}
          log_content: ${{ steps.logs.outputs.log_content }}
```

### For Extensive Logs (using artifacts)

```yaml
jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      # Run tests and save logs
      - name: Run tests
        run: npm test > test_logs.txt 2>&1
        continue-on-error: true
      
      # Save logs as artifact
      - name: Upload logs
        uses: actions/upload-artifact@v3
        with:
          name: test-logs
          path: test_logs.txt
  
  analyze-logs:
    needs: run-tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      # Download logs
      - name: Download logs
        uses: actions/download-artifact@v3
        with:
          name: test-logs
      
      # Read content and pass it to the action
      - name: Read logs
        id: read_logs
        run: |
          LOG_CONTENT=$(cat test_logs.txt)
          echo "logs<<EOF" >> $GITHUB_OUTPUT
          echo "$LOG_CONTENT" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      
      # Interpret logs
      - uses: your-username/voltaflow-pr-check@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          deepseek_api_key: ${{ secrets.DEEPSEEK_API_KEY }}
          log_content: ${{ steps.read_logs.outputs.logs }}
```

## Inputs

| Name | Description | Required |
|--------|-------------|-----------|
| `github_token` | GitHub token to comment on the PR | Yes |
| `deepseek_api_key` | API Key for the Deepseek API | Yes |
| `log_content` | Log content to interpret | No |

## Outputs

| Name | Description |
|--------|-------------|
| `interpretation` | The interpretation generated by Deepseek |

## Deepseek API Configuration

To use this action, you need:

1. Create a Deepseek account
2. Obtain an API key from the dashboard
3. Add this API key as a secret in your GitHub repository

## Limitations

- Very extensive logs may exceed Deepseek's maximum context
- The quality of interpretation depends on the clarity of the logs provided

## Local Development

To test this action locally:

1. Clone the repository
2. Install dependencies with `npm install`
3. Run tests with:
   - `npm test` - Runs all tests with mocked API calls
   - `DEEPSEEK_API_KEY=your-api-key npm test` - Runs tests including real API calls to DeepSeek

4. For manual testing, you can use the test script:

```bash
# Configure environment variables
export DEEPSEEK_API_KEY=your-api-key
export GITHUB_TOKEN=your-github-token

# Run with an example log file
node index.js < test_logs.txt
```

The test suite includes both mocked tests and real API integration tests that will verify proper connection to the DeepSeek API. The real API tests are skipped by default unless you provide a DEEPSEEK_API_KEY environment variable.

## Contributions

Contributions are welcome! Please open an issue or pull request.

## License

ISC
